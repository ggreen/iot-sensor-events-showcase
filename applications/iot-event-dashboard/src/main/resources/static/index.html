
<!DOCTYPE html>
<html>
<head>

    <title>Connected IoT Demo</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function(){
      $("p").click(function(){
        $(this).hide();
      });
    });
    </script>
</head>
<style>
input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

div {
  border-radius: 5px;
  background-color: #f2f2f2;s
  padding: 20px;
}
</style>
<body>



<div id="mapid" style="width: 400px; height: 400px;"></div>
<script>

    var zoomNumber = 3;

    // Set  create a map of the center of US
	var mymap = L.map('mapid').setView([35.659807, -97.017174], zoomNumber);

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiamNiYWxvdSIsImEiOiJja204Y3Z5cjIwa2t1MndwOXhjMGVuMDN0In0.8h6HQJ_uvVKT2k5kVLTz_A', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(mymap);

	//window['V3AKJGEDV0GSGV9577'] = L.marker([33.9478264, -117.867065]);
	//window['V3AKJGEDV0GSGV9577'].addTo(mymap)
	//	.bindPopup("<b>Hello world!</b><br />I am a popup.");


	var popup = L.popup();

    function onMapClick(e) {
        popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(mymap);
    }

	mymap.on('click', onMapClick);

</script>

<script language="JavaScript">
    var overheatingIcon = L.icon({
            iconUrl: 'img/overheating.png',
            iconSize: [18, 35],
        });

    var source = new EventSource("/streamOverviewEvents-sse");
    source.onmessage = function(event) {

      var sensor = JSON.parse(event.data)

      drawSensorOverview(sensor);
    };

    function drawSensorOverview(sensorOverview)
    {


        if(typeof window[sensorOverview.id] !== 'undefined')
        {
            window[sensorOverview.id].remove();
        }


        var greenIcon = L.icon({
            iconUrl: 'img/green.png',
            iconSize:     [38, 95], // size of the icon
            shadowSize:   [50, 64], // size of the shadow
            iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
            shadowAnchor: [4, 62],  // the same for the shadow
            popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

        var sensorColor = 'green';

        if(sensorOverview.priority == 1)
        {
            sensorColor = 'orange';
         }
         else if(sensorOverview.priority > 1)
         {
            sensorColor = 'red';
         }


         window[sensorOverview.id] = L.circle([sensorOverview.sensor.sensorLocation.latitude, sensorOverview.sensor.sensorLocation.longitude], {
                    color: sensorColor,
                    fillColor: '#f03',
                    fillOpacity: 0.05,
                    radius: 50000
         }).addTo(mymap);



    }
</script>

<!--<button onclick="drawSensorOverview(null);">testing</button>-->


</body>
</html>
